<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
      /* Style pour positionner l'image */
      img {
        position: absolute;
        left: 100px;
        top: 100px;
        width: 50px;
        height: auto;
      }

      /* Style pour positionner la grid */
      #grid-container {
        position: absolute;
        left: 30px;
        top: 20px;
        width: 1300px;
        height: 550px;
      }

      /* Style pour dessiner la grille */
      .grid-square {
        border: 1px solid black;
        background-color: silver;
        /*width: 20px;
        height: 20px;*/
      }
    </style>
</head>
<body>
  <div id="grid-container"></div>

  <img src="unit.png">
    <script>

// Sélection de l'image à déplacer
const image = document.querySelector('img');

// Variables pour stocker la position de l'image et le mode de déplacement
let posImageX, posImageY, isMoving = false;

// Fonction qui sera exécutée lorsque l'utilisateur clique sur l'image
function onImageClick(event) {
  console.log("img click");
  if (isMoving) {
    // Si le mode de déplacement est activé, on calcule la nouvelle position de l'image
    let x = getCoords()[0]*square_size;
    let y = getCoords()[1]*square_size;
    let imgStyle = window.getComputedStyle(image);
    let imgWidth = parseInt(imgStyle.width);
    let imgHeight = parseInt(imgStyle.height);
    let gridLeft = parseInt(gridStyle.left);
    let gridTop = parseInt(gridStyle.top);
    console.log("x",x,"y",y,"w",imgWidth,"h",imgHeight);
    image.style.left = `${x - imgWidth + square_size + gridLeft}px`;
    image.style.top = `${y - imgHeight + square_size + gridTop}px`;
    isMoving = false;
  } else {
    // Si le mode de déplacement n'est pas activé, on stocke la position de l'image
    posImageX = image.offsetLeft;
    posImageY = image.offsetTop;
    console.log("posx",posImageX,"posy",posImageY);
    isMoving = true;
  }
  // Empêcher la propagation de l'événement de la souris au-delà de l'image
  event.stopPropagation();
}

// Fonction qui affiche les coordonnées de la case cliquée
function getCoords() {
  let gridLeft = parseInt(gridStyle.left);
  let gridTop = parseInt(gridStyle.top);
  console.log("grid left top",gridLeft,gridTop);
  return [Math.floor((event.clientX-gridLeft)/square_size), Math.floor((event.clientY-gridTop)/square_size)];
}

// Fonction qui sera exécutée lorsque l'utilisateur clique n'importe où sur la page
function onPageClick(event) {
  console.log("page click");
  console.log("x:",getCoords()[0],"y:",getCoords()[1]);
  let x = getCoords()[0]*square_size;
  let y = getCoords()[1]*square_size;
  console.log("x2:",x,"y2:",y);
  if (isMoving) {
    // Si le mode de déplacement est activé, on calcule la nouvelle position de l'image
    let imgStyle = window.getComputedStyle(image);
    let imgWidth = parseInt(imgStyle.width);
    let imgHeight = parseInt(imgStyle.height);
    let gridLeft = parseInt(gridStyle.left);
    let gridTop = parseInt(gridStyle.top);
    console.log("x",x,"y",y,"w",imgWidth,"h",imgHeight);
    image.style.left = `${x - imgWidth + square_size + gridLeft}px`;
    image.style.top = `${y - imgHeight + square_size + gridTop}px`;
    isMoving = false;
  }
}

// Ajout d'un écouteur d'événement pour détecter le clic sur l'image
image.addEventListener('click', onImageClick);

// Ajout d'un écouteur d'événement pour détecter le clic n'importe où sur la page
document.addEventListener('click', onPageClick);




function drawGrid(gridWidth, gridHeight, squareSize) {
  const gridContainer = document.getElementById("grid-container");

  // Effacer le contenu précédent de l'élément gridContainer
  gridContainer.innerHTML = "";

  // Définir les propriétés CSS pour l'élément gridContainer
  gridContainer.style.display = "grid";
  gridContainer.style.gridTemplateColumns = `repeat(${gridWidth}, ${squareSize}px)`;
  gridContainer.style.gridTemplateRows = `repeat(${gridHeight}, ${squareSize}px)`;

  // Dessiner les carrés dans l'élément gridContainer
  for (let i = 0; i < gridWidth * gridHeight; i++) {
    const square = document.createElement("div");
    square.classList.add("grid-square");
    gridContainer.appendChild(square);
  }
}

// Appel de la fonction drawGrid avec un paramètre gridSize de 10 (par exemple)
/*const pageWidth = window.innerWidth;
const pageHeight = window.innerHeight;*/
const gridContainer = document.getElementById("grid-container");
const gridStyle = window.getComputedStyle(gridContainer);
const gridWidth = parseInt(gridStyle.width);
const gridHeight = parseInt(gridStyle.height);
const square_size = 50;
console.log(gridWidth,gridHeight,square_size);
console.log(Math.floor(gridWidth/square_size), Math.floor(gridHeight/square_size), square_size);
drawGrid(Math.floor(gridWidth/square_size), Math.floor(gridHeight/square_size), square_size);




    </script>
</body>
</html>
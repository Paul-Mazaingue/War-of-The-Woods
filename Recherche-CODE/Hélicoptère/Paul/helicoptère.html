<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body {
            background-image: url('map.jpg');
            background-size: 2000px 1119px;
            background-repeat: no-repeat;
        }
        .particle {
            position: absolute;
            background-color: rgba(0, 0, 255, 0.5);
            pointer-events: none;
        }
    </style>
</head>
<body>
    <img id="helico" style="width:100px;height:100px;" src="helico2.gif"></img>
    <script>
        const helico = document.getElementById('helico');
        let x = 0;
        let y = 0;
        let rotation = 0;
        let isLanded = false;
        let canControl = true;
        let isAnimating = false;

        function updatePosition() {
            helico.style.transform = `translate(${x}px, ${y}px) rotate(${rotation}deg)`;
        }

        function createParticle(x, y, angle) {
            const particle = document.createElement('div');
            particle.classList.add('particle');
            particle.style.width = '1px';
            particle.style.height = '5px';
            particle.style.left = `${x}px`;
            particle.style.top = `${y}px`;
            particle.style.transform = `rotate(${angle}deg)`;
            document.body.appendChild(particle);
            return particle;
        }

        function animateParticle(particle, dx, dy) {
            const duration = 1000;
            const start = performance.now();

            function update() {
                const now = performance.now();
                const progress = Math.min(1, (now - start) / duration);

                const x = parseFloat(particle.style.left) + dx * progress;
                const y = parseFloat(particle.style.top) + dy * progress;
                particle.style.left = `${x}px`;
                particle.style.top = `${y}px`;

                if (progress < 1) {
                    requestAnimationFrame(update);
                } else {
                    document.body.removeChild(particle);
                }
            }

            requestAnimationFrame(update);
        }

        function emitParticle(x, y, dx, dy) {
            if (dx === 0 && dy === 0) {
                return;
            }
            const angle = Math.random() * 2 * Math.PI;
            const distance = 20 + Math.random() * 30;
            const particleX = x + 50 + Math.cos(angle) * distance;
            const particleY = y + 50 + Math.sin(angle) * distance;
            const particleAngle = (Math.atan2(dy, dx) * 180 / Math.PI) - 90;
            const particle = createParticle(particleX, particleY, particleAngle);
            animateParticle(particle, dx, dy);
        }

        async function landHelico() {
            const landingSpeed = 2;
            for (let i = 0; i < 10; i++) {
                helico.style.width = parseFloat(helico.style.width) - landingSpeed + 'px';
                helico.style.height = parseFloat(helico.style.height) - landingSpeed + 'px';
                await new Promise(resolve => setTimeout(resolve, 50));
            }
        }

        async function takeOffHelico() {
            const takeOffSpeed = 2;
            for (let i = 0; i < 10; i++) {
                helico.style.width = parseFloat(helico.style.width) + takeOffSpeed + 'px';
                helico.style.height = parseFloat(helico.style.height) + takeOffSpeed + 'px';
                await new Promise(resolve => setTimeout(resolve, 50));
            }
        }

const keyState = {};
document.addEventListener('keydown', event => {
    keyState[event.key] = true;
});
document.addEventListener('keyup', event => {
    keyState[event.key] = false;
});

function lerp(a, b, t) {
            return a + (b - a) * t;
        }

        function moveHelico() {
            const speed = 10;
            let dx = 0;
            let dy = 0;
            if (!isLanded && canControl) {
                if (keyState['ArrowUp'] || keyState['w']) {
                    dy -= speed;
                }
                if (keyState['ArrowDown'] || keyState['s']) {
                    dy += speed;
                }
                if (keyState['ArrowLeft'] || keyState['a']) {
                    dx -= speed;
                }
                if (keyState['ArrowRight'] || keyState['d']) {
                    dx += speed;
                }
                if (dx !== 0 && dy !== 0) {
                    dx *= Math.sqrt(0.5);
                    dy *= Math.sqrt(0.5);
                }

                // Emit wind particles if the helicopter is moving
                if (dx !== 0 || dy !== 0) {
                    emitParticle(x, y, -dx * 0.5, -dy * 0.5);
                }

                // Vérifie si les nouvelles coordonnées sont à l'intérieur des limites de la carte
                const newX = x + dx;
                const newY = y + dy;

                if (newX >= 0 && newX + parseFloat(helico.style.width) <= 2000) {
                    x = newX;
                }
                if (newY >= 0 && newY + parseFloat(helico.style.height) <= 1119) {
                    y = newY;
                }

                if (dx !== 0 || dy !== 0) {
                    const targetRotation = (Math.atan2(dy, dx) * 180 / Math.PI) + 90;
                    const delta = (targetRotation - rotation + 540) % 360 - 180;
                    rotation += delta * 0.1;
                }
            }
            updatePosition();
            requestAnimationFrame(moveHelico);
        }

document.addEventListener('keydown', async event => {
    if (event.key === ' ' && !isLanded && !isAnimating) {
        isLanded = true;
        canControl = false;
        isAnimating = true;
        // Faire atterrir l'hélico
        await landHelico();
        helico.src = "helico2-static.png";
        canControl = true;
        isAnimating = false;
    } else if (event.key === ' ' && isLanded && canControl && !isAnimating) {
        isLanded = false;
        // Faire décoller l'hélico
        canControl = false;
        isAnimating = true;
        helico.src = "helico2.gif";
        await takeOffHelico();
        canControl = true;
        isAnimating = false;
    }
});

moveHelico();
</script>
</body>
</html>
